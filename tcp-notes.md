### 为什么 TCP 序列号是从一个随机值开始的？
1. 安全。使序列号难以被攻击者猜到
2. 可用。 
    1. 考虑一个老 TCP 连接结束，但该 TCP 的 Segment 尚在网络中传输。此时一个新 TCP 连接开始，新 TCP 的源与目的端口号和老 TCP 相同。当老 TCP 的 Segment 传输至本机，该 Segment 会被误认为属于新 TCP，可能导致潜在的 Bug。
    2. 如果序列号随机，新老 TCP 的序列号区间重叠的概率大幅下降，老 TCP 的 Segment 的序列号很可能不在新 TCP 可接受区间范围内，从而被丢弃。尽管随机序列号虽然不能从根上解决该 Bug，能降低它的出现概率。
### SYN Cookie 是什么？
1. 背景：发起 SYN 攻击的攻击者往往会用虚假 IP 向被攻击服务器发送海量 SYN 包，由于是虚假 IP，攻击者不会收到也不会回复服务器发来的 SYN+ACK包。
2. 问题：在开启 SYN Cookie 之前，服务器会为每个 SYN 包维护一个套接字状态（双方的 IP 和端口号）。在海量 SYN 包下，服务器资源很快耗尽，以致无法回复正常用户请求。
3. 开启 SYN Cookie 之后，服务器在收到 SYN 包时，不会立即在本地维护一个套接字状态，而是把状态对称加密并编码为 TCP 的序列号（Cookie）通过 ACK+SYN 包发给请求方。请求方收到该包后，会 ACK 序列号+1。而服务器方会将从 ACK 号中还原序列号并解密和解码，只有序列号正确才会维护一个新的套接字状态。
4. 序列号的具体编码方式参见 https://www.youtube.com/watch?v=sLbihU82x7s
